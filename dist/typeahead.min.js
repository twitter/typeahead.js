/*!
 * typeahead.js 0.9.4
 * https://github.com/Svakinn/typeahead
 * Copyright 2013 Twitter, Inc. and other contributors; Licensed MIT
 */

(function(e){var t="0.9.4";var n={isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:false},isBlankString:function(e){return!e||/^\s*$/.test(e)},escapeRegExChars:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(e){return typeof e==="string"},isNumber:function(e){return typeof e==="number"},isArray:e.isArray,isFunction:e.isFunction,isObject:e.isPlainObject,isUndefined:function(e){return typeof e==="undefined"},bind:e.proxy,bindAll:function(t){var n;for(var r in t){e.isFunction(n=t[r])&&(t[r]=e.proxy(n,t))}},indexOf:function(e,t){for(var n=0;n<e.length;n++){if(e[n]===t){return n}}return-1},each:e.each,map:e.map,filter:e.grep,every:function(t,n){var r=true;if(!t){return r}e.each(t,function(e,i){if(!(r=n.call(null,i,e,t))){return false}});return!!r},some:function(t,n){var r=false;if(!t){return r}e.each(t,function(e,i){if(r=n.call(null,i,e,t)){return false}});return!!r},mixin:e.extend,getUniqueId:function(){var e=0;return function(){return e++}}(),defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var r,i;return function(){var s=this,o=arguments,u,a;u=function(){r=null;if(!n){i=e.apply(s,o)}};a=n&&!r;clearTimeout(r);r=setTimeout(u,t);if(a){i=e.apply(s,o)}return i}},throttle:function(e,t){var n,r,i,s,o,u;o=0;u=function(){o=new Date;i=null;s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);n=this;r=arguments;if(f<=0){clearTimeout(i);i=null;o=a;s=e.apply(n,r)}else if(!i){i=setTimeout(u,f)}return s}},tokenizeQuery:function(t){return e.trim(t).toLowerCase().split(/[\s]+/)},tokenizeText:function(t){return e.trim(t).toLowerCase().split(/[\s\-_]+/)},getProtocol:function(){return location.protocol},noop:function(){}};var r=function(){var e=/\s+/;return{on:function(t,n){var r;if(!n){return this}this._callbacks=this._callbacks||{};t=t.split(e);while(r=t.shift()){this._callbacks[r]=this._callbacks[r]||[];this._callbacks[r].push(n)}return this},trigger:function(t,n){var r,i;if(!this._callbacks){return this}t=t.split(e);while(r=t.shift()){if(i=this._callbacks[r]){for(var s=0;s<i.length;s+=1){i[s].call(this,{type:r,data:n})}}}return this}}}();var i=function(){function r(t){if(!t||!t.el){e.error("EventBus initialized without el")}this.$el=e(t.el)}var t="typeahead:";n.mixin(r.prototype,{trigger:function(e){var n=[].slice.call(arguments,1);this.$el.trigger(t+e,n)}});return r}();var s=function(){function i(e){this.prefix=["__",e,"__"].join("");this.ttlKey="__ttl__";this.keyMatcher=new RegExp("^"+this.prefix)}function s(){return(new Date).getTime()}function o(e){return JSON.stringify(n.isUndefined(e)?null:e)}function u(e){return JSON.parse(e)}var e,t;try{e=window.localStorage;e.setItem("~~~","!");e.removeItem("~~~")}catch(r){e=null}if(e&&window.JSON){t={_prefix:function(e){return this.prefix+e},_ttlKey:function(e){return this._prefix(e)+this.ttlKey},get:function(t){if(this.isExpired(t)){this.remove(t)}return u(e.getItem(this._prefix(t)))},set:function(t,r,i){if(n.isNumber(i)){e.setItem(this._ttlKey(t),o(s()+i))}else{e.removeItem(this._ttlKey(t))}return e.setItem(this._prefix(t),o(r))},remove:function(t){e.removeItem(this._ttlKey(t));e.removeItem(this._prefix(t));return this},clear:function(){var t,n,r=[],i=e.length;for(t=0;t<i;t++){if((n=e.key(t)).match(this.keyMatcher)){r.push(n.replace(this.keyMatcher,""))}}for(t=r.length;t--;){this.remove(r[t])}return this},isExpired:function(t){var r=u(e.getItem(this._ttlKey(t)));return n.isNumber(r)&&s()>r?true:false}}}else{t={get:n.noop,set:n.noop,remove:n.noop,clear:n.noop,isExpired:n.noop}}n.mixin(i.prototype,t);return i}();var o=function(){function e(e){n.bindAll(this);e=e||{};this.sizeLimit=e.sizeLimit||10;this.cache={};this.cachedKeysByAge=[]}n.mixin(e.prototype,{get:function(e){return this.cache[e]},set:function(e,t){var n;if(this.cachedKeysByAge.length===this.sizeLimit){n=this.cachedKeysByAge.shift();delete this.cache[n]}this.cache[e]=t;this.cachedKeysByAge.push(e)},clear:function(){this.cache={};this.cachedKeysByAge=[]}});return e}();var u=function(){function u(e){n.bindAll(this);e=n.isString(e)?{url:e}:e;s=s||new o;i=n.isNumber(e.maxParallelRequests)?e.maxParallelRequests:i||6;this.url=e.url;this.handler=e.handler=typeof e.handler==="function"?e.handler:null;this.wildcard=e.wildcard||"%QUERY";this.filter=e.filter;this.replace=e.replace;this.name=e.name;this.cacheKey=e.cacheKey;this.skipCache=e.skipCache;if(this.url){this.ajaxSettings={type:"get",cache:e.cache,timeout:e.timeout,dataType:e.dataType||"json",beforeSend:e.beforeSend}}this._get=(/^throttle$/i.test(e.rateLimitFn)?n.throttle:n.debounce)(this._get,e.rateLimitWait||300)}function a(){t++}function f(){t--}function l(){return t<i}var t=0,r={},i,s;n.mixin(u.prototype,{_get:function(t,n,r,i){function a(e){var t=o.filter?o.filter(e):e;n&&n(t);this.skipCache||s.set(i,e)}var o=this,u=[];if(l()){if(this.handler)if(typeof Q!=="undefined")return Q.when(this._sendRequest(r,u)).then(function(){a(u);return Q.resolve(true)});else return e.when(this._sendRequest(r,u)).then(function(){a(u);return e.Deferred().resolve()});else return this._sendRequest(t).done(a)}else{return this.onDeckRequestArgs=[].slice.call(arguments,0)}},_sendRequest:function(t,n){function o(){f();r[t]=null;if(i.onDeckRequestArgs){i._get.apply(i,i.onDeckRequestArgs);i.onDeckRequestArgs=null}}var i=this,s=r[t];if(!s){a();if(this.handler)if(Q)s=Q.when(this.handler(t,n)).then(function(){o();return Q.resolve(true)});else s=e.when(this.handler(t,n)).then(function(){o();return e.Deferred().resolve()});else s=r[t]=e.ajax(t,this.ajaxSettings).always(o)}return s},get:function(e,t){var r=this,i=encodeURIComponent(e||""),o,u,a;t=t||n.noop;o=this.url?this.replace?this.replace(this.url,i):this.url.replace(this.wildcard,i):"";if(typeof this.cacheKey==="function")a=this.cacheKey(e);else a=this.cacheKey?this.cacheKey+"%_"+e:o;if(!this.skipCache&&(u=s.get(a))){n.defer(function(){t(r.filter?r.filter(u):u)})}else{this._get(o,t,e,a)}return!!u},clearCache:function(){this.skipCache||s.clear()}});return u}();var a=function(){function i(t){n.bindAll(this);if(n.isString(t.template)&&!t.engine){e.error("no template engine specified")}if(!t.local&&!t.prefetch&&!t.remote){e.error("one of local, prefetch or remote is required")}this.name=t.name||n.getUniqueId();this.limit=t.limit||5;if(t.minLength===0)this.minLength=0;else this.minLength=t.minLength||1;this.cacheKeyFn=null;if(typeof t.cacheKey==="function"){this.cacheKey=t.cacheKey();this.cacheKeyFn=t.cacheKey}else this.cacheKey=t.cacheKey?t.cacheKey:t.name;this.header=t.header;this.footer=t.footer;this.valueKey=t.valueKey||"value";this.nameKey=t.nameKey||this.valueKey;this.restrictInputToDatum=t.restrictInputToDatum;this.template=o(t.template,t.engine,this.nameKey);this.local=t.local;this.prefetch=t.prefetch;this.remote=t.remote;this.localSearcher=t.localSearcher;this.itemHash={};this.adjacencyList={};this.nameAdjacencyList={};this.storage=this.cacheKey?new s(this.cacheKey):null}function o(e,t,r){var i,s;if(n.isFunction(e)){i=e}else if(n.isString(e)){s=t.compile(e);i=n.bind(s.render,s)}else{i=function(e){return"<p>"+e[r]+"</p>"}}return i}var r={thumbprint:"thumbprint",protocol:"protocol",itemHash:"itemHash",adjacencyList:"adjacencyList",nameAdjacencyList:"nameAdjacencyList"};n.mixin(i.prototype,{_processLocalData:function(e){this._mergeProcessedData(this._processData(e))},_loadPrefetchData:function(i){function v(e,t,n){console.log("Prefetch error: "+n.message)}function m(e){var t=i.filter?i.filter(e):e,u=s._processData(t),a=u.itemHash,f=u.adjacencyList,l=u.nameAdjacencyList;if(s.storage){s.storage.set(r.itemHash,a,i.ttl);s.storage.set(r.adjacencyList,f,i.ttl);s.storage.set(r.nameAdjacencyList,l,i.ttl);s.storage.set(r.thumbprint,o,i.ttl);s.storage.set(r.protocol,n.getProtocol(),i.ttl)}s._mergeProcessedData(u)}var s=this,o=t+(i.thumbprint||""),u,a,f,l,c,h=true,p;i=n.isString(i)?{url:i}:i;i.ttl=n.isNumber(i.ttl)?i.ttl:24*60*60*1e3;if(!i.skipCache&&i.ttl>0){if(this.storage){u=this.storage.get(r.thumbprint);a=this.storage.get(r.protocol);f=this.storage.get(r.itemHash);l=this.storage.get(r.adjacencyList);c=this.storage.get(r.nameAdjacencyList)}h=u!==o||a!==n.getProtocol()}if(!i.skipCache&&i.ttl>0&&f&&l&&c&&!h){this._mergeProcessedData({itemHash:f,adjacencyList:l,nameAdjacencyList:c});p=e.Deferred().resolve()}else{if(i.prefetchHandler&&typeof i.prefetchHandler==="function"){if(typeof Q!=="undefined"){p=e.Deferred();Q.when(i.prefetchHandler()).then(d).fail(function(e){p.resolve()})}else{p=e.when(i.prefetchHandler()).done(m)}function d(e){m(e);p.resolve();return Q.resolve(true)}}else if(i.url)p=e.getJSON(i.url).done(m).fail(v)}return p},_transformDatum:function(e){var t=n.isString(e)?e:e[this.valueKey],r=n.isString(e)?e:e[this.nameKey],i=e.tokens||n.tokenizeText(t),s={value:t,name:r,tokens:i,dsname:this.name};if(n.isString(e)){s.datum={};s.datum[this.valueKey]=e}else{s.datum=e}return s},_processData:function(e){var t=this,r={},i={},s={};n.each(e,function(e,o){var u=t._transformDatum(o),a=n.getUniqueId(u.value);r[a]=u;var f=u.name.charAt(0).toLowerCase();nameAdjacency=s[f]||(s[f]=[a]);!~n.indexOf(nameAdjacency,a)&&nameAdjacency.push(a);n.each(u.tokens,function(e,t){var r=t.charAt(0).toLowerCase();adjacency=i[r]||(i[r]=[a]);!~n.indexOf(adjacency,a)&&adjacency.push(a)})});return{itemHash:r,adjacencyList:i,nameAdjacencyList:s}},_mergeProcessedData:function(e){var t=this;n.mixin(this.itemHash,e.itemHash);n.each(e.adjacencyList,function(e,n){var r=t.adjacencyList[e];t.adjacencyList[e]=r?r.concat(n):n});n.each(e.nameAdjacencyList,function(e,n){var r=t.nameAdjacencyList[e];t.nameAdjacencyList[e]=r?r.concat(n):n})},_getLocalSuggestions:function(e){var t=[],r=e.toLowerCase(),i,s=0,o=new RegExp("^"+r,"i");if(e===null||e===""){var u=this.limit;n.each(this.itemHash,function(e,n){t.push(n);s++;if(s==u)return false})}else{var a=this.nameAdjacencyList[r.charAt(0)];if(a){i=a.length;for(var f=0;f<i;f++){var l=this.itemHash[a[f]];if(l.name.search(o)===0){t.push(l);s++}if(s==this.limit)break}}if(s<this.limit){var c=this.adjacencyList[r.charAt(0)];if(!c)return t;i=c.length;for(var f=0;f<i;f++){var l=this.itemHash[c[f]];var h=n.some(l.tokens,function(e){return e.search(o)===0});if(h){var p=false;n.each(t,function(e,t){if(t.value==l.value){p=true;return false}});if(!p){t.push(l);s++;if(s==this.limit)break}}}}}return t},initialize:function(){var t;this.local&&this._processLocalData(this.local);if(this.remote&&typeof this.remote==="function")this.remote={handler:this.remote};if(this.prefetch&&typeof this.prefetch==="function")this.prefetch={prefetchHandler:this.prefetch};if(this.remote&&!this.remote.url&&!this.remote.cacheKey&&!this.remote.name)this.remote.cacheKey=this.cacheKey||this.remote.name||this.name;this.transport=this.remote?new u(this.remote):null;this.isRemote=this.remote?true:false;t=this.prefetch?this._loadPrefetchData(this.prefetch):e.Deferred().resolve();this.initialize=function(){return t};return t},getSuggestions:function(e,t){function u(e){s=s.slice(0);n.each(e,function(e,t){var i=r._transformDatum(t),o;o=n.some(s,function(e){return i.value===e.value});!o&&s.push(i);return s.length<r.limit});t&&t(s)}var r=this,i,s,o=false;if(e.length<this.minLength){return}if(this.localSearcher&&typeof this.localSearcher==="function")suggestons=this.localSearcher(e,this);else s=this._getLocalSuggestions(e);if(this.transport)o=this.transport.get(e,u);!o&&t&&t(s)},reload:function(){var t;if(this.cacheKeyFn){var n=this.cacheKey;this.cacheKey=this.cacheKeyFn();if(this.cacheKey!=n)this.clearCache()}this.local&&this._processLocalData(this.local);return this.prefetch?this._loadPrefetchData(this.prefetch):e.Deferred().resolve()},clearCache:function(){if(this.storage)this.storage.clear();if(this.transport)this.transport.clearCache()}});return i}();var f=function(){function t(t){var r=this;n.bindAll(this);this.specialKeyCodeMap={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"};this.tracer=t.tracer;this.$hint=e(t.hint);this.$input=e(t.input).on("blur.tt",this._handleBlur).on("focus.tt",this._handleFocus).on("keydown.tt",this._handleSpecialKeyEvent);if(!n.isMsie()){this.$input.on("input.tt",this._compareQueryToInputValue)}else{this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(e){if(r.specialKeyCodeMap[e.which||e.keyCode]){return}n.defer(r._compareQueryToInputValue)})}this.query=this.$input.val();this.$overflowHelper=i(this.$input)}function i(t){return e("<span></span>").css({position:"absolute",left:"-9999px",visibility:"hidden",whiteSpace:"nowrap",fontFamily:t.css("font-family"),fontSize:t.css("font-size"),fontStyle:t.css("font-style"),fontVariant:t.css("font-variant"),fontWeight:t.css("font-weight"),wordSpacing:t.css("word-spacing"),letterSpacing:t.css("letter-spacing"),textIndent:t.css("text-indent"),textRendering:t.css("text-rendering"),textTransform:t.css("text-transform")}).insertAfter(t)}function s(e,t){e=(e||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ");t=(t||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ");return e===t}n.mixin(t.prototype,r,{_handleFocus:function(){this.trigger("focused")},_handleBlur:function(){this.trigger("blured")},_handleSpecialKeyEvent:function(e){var t=this.specialKeyCodeMap[e.which||e.keyCode];t&&this.trigger(t+"Keyed",e)},_compareQueryToInputValue:function(){var e=this.getInputValue(),t=s(this.query,e),n=t?this.query.length!==e.length:false;if(n){this.trigger("whitespaceChanged",{value:this.query})}else if(!t){this.trigger("queryChanged",{value:this.query=e})}},destroy:function(){this.$hint.off(".tt");this.$input.off(".tt");this.$hint=this.$input=this.$overflowHelper=null},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query},setQuery:function(e){this.query=e},getInputValue:function(){return this.$input.val()},setInputValue:function(e,t){this.$input.val(e);!t&&this._compareQueryToInputValue()},getHintValue:function(){return this.$hint.val()},setHintValue:function(e){this.$hint.val(e)},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},isOverflow:function(){this.$overflowHelper.text(this.getInputValue());return this.$overflowHelper.width()>this.$input.width()},isCursorAtEnd:function(){var e=this.$input.val().length,t=this.$input[0].selectionStart,r;if(n.isNumber(t)){return t===e}else if(document.selection){r=document.selection.createRange();r.moveStart("character",-e);return e===r.text.length}return true}});return t}();var l=function(){function s(t){n.bindAll(this);this.tracer=t.tracer;this.isOpen=false;this.isEmpty=true;this.isMouseOverDropdown=false;this.$menu=e(t.menu).on("mousedown.tt",this._handleMouseDown).on("mouseenter.tt",this._handleMouseenter).on("mouseleave.tt",this._handleMouseleave).on("click.tt",".tt-suggestion",this._handleSelection).on("mouseover.tt",".tt-suggestion",this._handleMouseover)}function o(e){return e.data("suggestion")}var t={suggestionsList:'<span class="tt-suggestions"></span>'},i={suggestionsList:{display:"block"},suggestion:{whiteSpace:"nowrap",cursor:"pointer"},suggestionChild:{whiteSpace:"normal"}};n.mixin(s.prototype,r,{_handleMouseenter:function(){this.isMouseOverDropdown=true},_handleMouseleave:function(){this.isMouseOverDropdown=false},_handleMouseover:function(t){var n=e(t.currentTarget);this._getSuggestions().removeClass("tt-is-under-cursor");n.addClass("tt-is-under-cursor")},_handleMouseDown:function(e){e.preventDefault()},_handleSelection:function(t){var n=e(t.currentTarget);this.trigger("suggestionSelected",o(n))},_show:function(){this.$menu.css("display","block")},_hide:function(){this.$menu.hide()},_moveCursor:function(e){var t,n,r,i;if(!this.isVisible()){return}t=this._getSuggestions();n=t.filter(".tt-is-under-cursor");n.removeClass("tt-is-under-cursor");r=t.index(n)+e;r=(r+1)%(t.length+1)-1;if(r===-1){this.trigger("cursorRemoved");return}else if(r<-1){r=t.length-1}i=t.eq(r).addClass("tt-is-under-cursor");this._ensureVisibility(i);this.trigger("cursorMoved",o(i))},_getSuggestions:function(){return this.$menu.find(".tt-suggestions > .tt-suggestion")},_ensureVisibility:function(e){var t=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10),n=this.$menu.scrollTop(),r=e.position().top,i=r+e.outerHeight(true);if(r<0){this.$menu.scrollTop(n+r)}else if(t<i){this.$menu.scrollTop(n+(i-t))}},destroy:function(){this.$menu.off(".tt");this.$menu=null},isVisible:function(){return this.isOpen&&!this.isEmpty},closeUnlessMouseIsOverDropdown:function(){if(!this.isMouseOverDropdown){this.close()}},close:function(){if(this.isOpen){this.isOpen=false;this.isMouseOverDropdown=false;this._hide();this.$menu.find(".tt-suggestions > .tt-suggestion").removeClass("tt-is-under-cursor");this.trigger("closed")}},open:function(){if(!this.isOpen){this.isOpen=true;!this.isEmpty&&this._show();this.trigger("opened")}},setLanguageDirection:function(e){var t={left:"0",right:"auto"},n={left:"auto",right:" 0"};e==="ltr"?this.$menu.css(t):this.$menu.css(n)},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(+1)},getSuggestionUnderCursor:function(){var e=this._getSuggestions().filter(".tt-is-under-cursor").first();return e.length>0?o(e):null},getFirstSuggestion:function(){var e=this._getSuggestions().first();return e.length>0?o(e):null},renderSuggestions:function(r,s){var o="tt-dataset-"+r.name,u='<div class="tt-suggestion">%body</div>',a,f,l=this.$menu.find("."+o),c,h,p;if(l.length===0){f=e(t.suggestionsList).css(i.suggestionsList);l=e("<div></div>").addClass(o).append(r.header).append(f).append(r.footer).appendTo(this.$menu)}if(s.length>0){this.isEmpty=false;this.isOpen&&this._show();c=document.createElement("div");h=document.createDocumentFragment();n.each(s,function(t,n){n.dataset=r.name;a=r.template(n.datum);c.innerHTML=u.replace("%body",a);p=e(c.firstChild).css(i.suggestion).data("suggestion",n);p.children().each(function(){e(this).css(i.suggestionChild)});h.appendChild(p[0])});l.show().find(".tt-suggestions").html(h)}else{this.clearSuggestions(r.name)}this.trigger("suggestionsRendered")},clearSuggestions:function(e){var t=e?this.$menu.find(".tt-dataset-"+e):this.$menu.find('[class^="tt-dataset-"]'),n=t.find(".tt-suggestions");t.hide();n.empty();if(this._getSuggestions().length===0){this.isEmpty=true;this._hide()}}});return s}();var c=function(){function s(e){var t,r,i;n.bindAll(this);this.$node=o(e.input);this.selectedDatum=null;this.selectedDatumDsName=null;this.datasets=e.datasets;this.dir=null;this.eventBus=e.eventBus;this.hasRemote=false;this.dsnameAny=null;this.restrictInputToDatum=null;this.tracer=null;this.dsIdx=[];this.minMinLength=null;if(this.datasets&&this.datasets.length>0){for(var s=0;s<this.datasets.length;s++){this.dsIdx[this.datasets[s].name]=this.datasets[s];if(!this.dsnameAny)this.dsnameAny=this.datasets[s].name;if(this.datasets[s].isRemote){this.hasRemote=true;this.dsnameAny=this.datasets[s].name}if(!this.restrictInputToDatum&&this.datasets[s].restrictInputToDatum)this.restrictInputToDatum=this.datasets[s].restrictInputToDatum;if(!this.tracer)this.tracer=this.datasets[s].tracer;if(this.minMinLength===null||this.minMinLength>this.datasets[s].minLength)this.minMinLength=this.datasets[s].minLength}}if(!this.tracer)this.tracer=[];t=this.$node.find(".tt-dropdown-menu");r=this.$node.find(".tt-query");i=this.$node.find(".tt-hint");this.dropdownView=(new l({menu:t,tracer:this.tracer})).on("suggestionSelected",this._handleSelection).on("cursorMoved",this._clearHint).on("cursorMoved",this._setInputValueToSuggestionUnderCursor).on("cursorRemoved",this._setInputValueToQuery).on("cursorRemoved",this._updateHint).on("suggestionsRendered",this._updateHint).on("opened",this._updateHint).on("closed",this._clearHint).on("opened closed",this._propagateEvent);this.inputView=(new f({input:r,hint:i,tracer:this.tracer})).on("focused",this._openDropdown).on("blured",this._closeDropdown).on("blured",this._setInputValueToQuery).on("blured",this._manageLeaving).on("enterKeyed tabKeyed",this._handleSelection).on("queryChanged",this._clearHint).on("queryChanged",this._clearSuggestions).on("queryChanged",this._getSuggestions).on("whitespaceChanged",this._updateHint).on("queryChanged whitespaceChanged",this._openDropdown).on("queryChanged whitespaceChanged",this._setLanguageDirection).on("escKeyed",this._closeDropdown).on("escKeyed",this._setInputValueToQuery).on("tabKeyed upKeyed downKeyed",this._managePreventDefault).on("upKeyed downKeyed",this._moveDropdownCursor).on("upKeyed downKeyed",this._openDropdown).on("tabKeyed leftKeyed rightKeyed",this._autocomplete)}function o(n){var r=e(t.wrapper),s=e(t.dropdown),o=e(n),u=e(t.hint);r=r.css(i.wrapper);s=s.css(i.dropdown);u.css(i.hint).css({backgroundAttachment:o.css("background-attachment"),backgroundClip:o.css("background-clip"),backgroundColor:o.css("background-color"),backgroundImage:o.css("background-image"),backgroundOrigin:o.css("background-origin"),backgroundPosition:o.css("background-position"),backgroundRepeat:o.css("background-repeat"),backgroundSize:o.css("background-size")});o.data("ttAttrs",{dir:o.attr("dir"),autocomplete:o.attr("autocomplete"),spellcheck:o.attr("spellcheck"),style:o.attr("style")});o.addClass("tt-query").attr({autocomplete:"off",spellcheck:false}).css(i.query);try{!o.attr("dir")&&o.attr("dir","auto")}catch(a){}return o.wrap(r).parent().prepend(u).append(s)}function u(e){var t=e.find(".tt-query");n.each(t.data("ttAttrs"),function(e,r){n.isUndefined(r)?t.removeAttr(e):t.attr(e,r)});t.detach().removeData("ttAttrs").removeClass("tt-query").insertAfter(e);e.remove()}var t={wrapper:'<span class="twitter-typeahead"></span>',hint:'<input class="tt-hint" type="text" autocomplete="off" spellcheck="off" disabled>',dropdown:'<span class="tt-dropdown-menu"></span>'},i={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none"},query:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},dropdown:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"}};if(n.isMsie()){n.mixin(i.query,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"})}if(n.isMsie()&&n.isMsie()<=7){n.mixin(i.wrapper,{display:"inline",zoom:"1"});n.mixin(i.query,{marginTop:"-1px"})}n.mixin(s.prototype,r,{_managePreventDefault:function(e){var t=e.data,n,r,i=false;switch(e.type){case"tabKeyed":n=this.inputView.getHintValue();r=this.inputView.getInputValue();i=n&&n!==r;break;case"upKeyed":case"downKeyed":i=!t.shiftKey&&!t.ctrlKey&&!t.metaKey;break}i&&t.preventDefault()},_manageLeaving:function(e){var t=this.inputView.getInputValue();var n=typeof this.restrictInputToDatum==="function"?this.restrictInputToDatum():this.restrictInputToDatum;if(t===null||t.length===0){if(!this.selectedDatum||this.selectedDatum[this.dsIdx[this.selectedDatumDsName].nameKey]){this.selectedDatum=null;this.eventBus.trigger("noSelect","")}}else if(this.selectedDatum&&t!=this.selectedDatum[this.dsIdx[this.selectedDatumDsName].nameKey]){if(n){this.inputView.setInputValue(this.selectedDatum[this.dsIdx[this.selectedDatumDsName].nameKey],true)}else{this.selectedDatum=null;this.eventBus.trigger("noSelect",t)}}else if(!this.selectedDatum&&t!==null&&t.length>0){if(n)this.inputView.setInputValue("",true);this.eventBus.trigger("noSelect",t)}},_setLanguageDirection:function(){var e=this.inputView.getLanguageDirection();if(e!==this.dir){this.dir=e;this.$node.css("direction",e);this.dropdownView.setLanguageDirection(e)}},_updateHint:function(){var e=this.dropdownView.getFirstSuggestion(),t=e?e.name:null,r=this.dropdownView.isVisible(),i=this.inputView.isOverflow(),s,o,u,a,f;if(t&&r&&!i){s=this.inputView.getInputValue();o=s.replace(/\s{2,}/g," ").replace(/^\s+/g,"");u=n.escapeRegExChars(o);a=new RegExp("^(?:"+u+")(.*$)","i");f=a.exec(t);this.inputView.setHintValue(s+(f?f[1]:""))}},_clearHint:function(){this.inputView.setHintValue("")},_clearSuggestions:function(){this.dropdownView.clearSuggestions()},_setInputValueToQuery:function(){this.inputView.setInputValue(this.inputView.getQuery())},_setInputValueToSuggestionUnderCursor:function(e){var t=e.data;this.inputView.setInputValue(t.name,true)},_openDropdown:function(e){this.dropdownView.open()},_closeDropdown:function(e){this.dropdownView[e.type==="blured"?"closeUnlessMouseIsOverDropdown":"close"]()},_moveDropdownCursor:function(e){var t=e.data;if(!t.shiftKey&&!t.ctrlKey&&!t.metaKey){this.dropdownView[e.type==="upKeyed"?"moveCursorUp":"moveCursorDown"]()}},_handleSelection:function(e){if(e.data&&e.data.hasOwnProperty("datum"))suggestion=e.data;else suggestion=this.dropdownView.getSuggestionUnderCursor();if(suggestion){this.inputView.setQuery(suggestion.name);this.inputView.setInputValue(suggestion.name,true);this.selectedDatumDsName=suggestion.dsname;this.selectedDatum=suggestion.datum;this._clearSuggestions();this._getSuggestions();this.dropdownView.close();this.eventBus.trigger("selected",suggestion.datum,suggestion.dataset)}},_getSuggestions:function(){var e=this,t=this.inputView.getQuery();if(this.minMinLength!==0&&n.isBlankString(t)){return}n.each(this.datasets,function(n,r){r.getSuggestions(t,function(n){if(t===e.inputView.getQuery()){e.dropdownView.renderSuggestions(r,n)}})})},_autocomplete:function(e){var t,n,r,i,s;if(e.type==="rightKeyed"||e.type==="leftKeyed"){t=this.inputView.isCursorAtEnd();n=this.inputView.getLanguageDirection()==="ltr"?e.type==="leftKeyed":e.type==="rightKeyed";if(!t||n){return}}r=this.inputView.getQuery();i=this.inputView.getHintValue();if(i!==""&&r!==i){s=this.dropdownView.getFirstSuggestion();this.selectedDatum=s.datum;this.selectedDatumDsName=s.dsname;this.inputView.setInputValue(s.name);this.eventBus.trigger("autocompleted",s.datum,s.dataset)}},_propagateEvent:function(e){this.eventBus.trigger(e.type)},destroy:function(){this.inputView.destroy();this.dropdownView.destroy();u(this.$node);this.$node=null},setQuery:function(e){this.inputView.setQuery(e);this.inputView.setInputValue(e);this._clearHint();this._clearSuggestions();this._getSuggestions()},setDatum:function(e,t){t=t?t:this.dsnameAny;if(t&&this.dsIdx[t].nameKey){this.selectedDatumDsName=t;this.selectedDatum=e;query=e?e[this.dsIdx[t].nameKey]:"";this.inputView.setQuery(query);this.inputView.setInputValue(query);this._clearHint();this._clearSuggestions();this._getSuggestions()}}});return s}();(function(){var t={},r="ttView",s,o;s={initialize:function(s){function u(){var t=e(this),s;eventBus=new i({el:t});s=n.map(o,function(e){return e.initialize()});t.data(r,new c({input:t,eventBus:eventBus=new i({el:t}),datasets:o}));e.when.apply(e,s).always(function(){n.defer(function(){eventBus.trigger("initialized")})})}var o;s=n.isArray(s)?s:[s];if(s.length===0){e.error("no datasets provided")}o=n.map(s,function(e){var n=t[e.name]?t[e.name]:new a(e);if(e.name){t[e.name]=n}return n});return this.each(u)},reload:function(){function o(){var t=i&&i.datasets?i.datasets:null;s=n.map(t,function(e){return e.reload()});e.when.apply(e,s).always(function(){n.defer(function(){eventBus.trigger("reloaded")})});return s}var t=e(this),i=e(this).data(r),s;return this.each(o)},destroy:function(){function t(){var t=e(this),n=t.data(r);if(n){n.destroy();t.removeData(r)}}return this.each(t)},setQuery:function(t){var n=e(this).data(r);n&&n.setQuery(t)},setDatum:function(t,n){var i=e(this).data(r);i&&i.setDatum(t,n)},getDatum:function(){var t=e(this).data(r);return t&&t.selectedDatum},getQuery:function(){var t=e(this).data(r);return t&&t.inputView.getInputValue()},clearCache:function(){function s(e,t){t.clearCache()}var t=e(this).data(r);var i=t&&t.datasets?t.datasets:null;n.each(i,s)},openDropdown:function(){var t=e(this).data(r);t&&t.dropdownView.open()},closeDropdown:function(){var t=e(this).data(r);t&&t.dropdownView.close()}};jQuery.fn.typeahead=function(e){if(s[e]){return s[e].apply(this,[].slice.call(arguments,1))}else{return s.initialize.apply(this,arguments)}}})()})(window.jQuery);